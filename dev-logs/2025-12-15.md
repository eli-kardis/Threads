# 📋 개발일지: 2025-12-15

---

## 1. 📝 기본 정보
* **날짜:** 2025-12-15 (일) 15:30 ~ 23:12ss
* **프로젝트:** Threads to Notion Sync (Chrome Extension) - 스레드 게시글을 노션 데이터베이스에 자동 동기화하는 크롬 확장 프로그램
* **작업 요약:** 동기화 로직 통일, shares 메트릭 추가, 팝업/대시보드 동기화 기능 고도화 (popupSync 함수)
* **진행률:** 95% (핵심 기능 완성, Meta 앱 검수 대기 중)
* **커밋 횟수:** 3회

---

## 2. 🗣️ 요구사항 역추적 (Prompt Archive)

### **[요청 1]** "아직도 메인화면에서 동기화 시작 버튼을 누르면 노션에 동기화가 잘 되는데, 여기서 지금 동기화를 누르면 새로운 글이 동기화가 안돼"
* **의도:** 팝업의 "지금 동기화" 버튼이 새 글을 동기화하지 못하는 버그 수정
* **AI의 해석:** 두 버튼(옵션 vs 팝업)의 필터링 로직 불일치 문제로 파악. 팝업은 `lastSyncTime` 기반, 옵션은 `ID` 기반으로 동작하고 있었음
* **Gap:** 처음에 "의도적 차이"인지 "버그"인지 명확하지 않았음. "둘 다 ID 기반으로 통일해줘"라고 했으면 더 빨랐을 것

### **[요청 2]** "인사이트 불러올 때 공유수도 불러오게 되어있어?"
* **의도:** Threads API의 `shares` 메트릭이 누락되어 있는지 확인 후 추가
* **AI의 해석:** 처음에 `reposts`(리포스트)와 `shares`(외부 공유)를 혼동. 사용자가 "shares 있어"라고 명시해줌
* **Gap:** "공유수"라는 한국어 표현이 reposts인지 shares인지 모호했음. API 필드명을 직접 언급했으면 혼란이 없었을 것

### **[요청 3]** "노션에 저장된 데이터와 대시보드에 있는 데이터가 맞지 않는다고. 뭐가 문제인지 꼼꼼히 찾아봐"
* **의도:** shares가 노션에는 저장되는데 대시보드에는 0으로 표시되는 불일치 해결
* **AI의 해석:** 데이터 흐름 추적 결과, `storage.js`의 두 함수에서 shares 필드 누락 발견
* **Gap:** "데이터가 맞지 않다"는 표현만으로 원인 파악에 시간 소요. "노션엔 저장되는데 대시보드만 0이야"라고 했으면 더 빨랐을 것

### **[요청 4]** "팝업의 동기화 버튼을 클릭하면 작성일 기준 14일 이전까지의 게시글 인사이트 새로고침 + 가장 마지막 게시글의 작성시간 이후로 새로운 글이 있는지 체크 후 동기화 하게끔 수정해줘"
* **의도:** 팝업 동기화 버튼의 기능 확장 (인사이트 새로고침 + 새 글 동기화)
* **AI의 해석:** 명확한 요청. "무엇을 + 어떤 기준으로 + 언제" 모두 포함된 **완벽한 프롬프트**
* **Gap:** 없음 - 이번 요청은 프롬프트의 모범 사례!

---

## 3. 🏗️ 구현 결과물 (Code & Structure)

### **변경된 파일 구조:**
```
src/
├── api/
│   ├── threads.js       # shares 메트릭 추가
│   └── notion.js        # shares 필드 매핑 추가
├── storage/
│   └── storage.js       # syncInterval 5분, shares 필드 추가
├── ui/
│   ├── popup.js         # 결과 표시 형식 변경
│   ├── options.html     # shares 필드 매핑 UI
│   ├── options.js       # shares 매핑 로직
│   ├── dashboard.html   # 6열 그리드, 인용/공유 카드
│   └── dashboard.js     # popupSync() 호출로 변경
└── background.js        # popupSync() 함수 추가, 로직 통일
```

### **파일 변경 요약:**

| 파일 경로 | 변경 유형 | 핵심 변경 내용 |
|----------|---------|--------------|
| src/background.js | 추가/수정 | `popupSync()` 함수 추가, SYNC_NOW가 popupSync 호출 |
| src/storage/storage.js | 수정 | syncInterval 1분→5분, shares 필드 추가 |
| src/api/threads.js | 수정 | `metric: 'views,likes,replies,reposts,quotes,shares'` |
| src/api/notion.js | 수정 | buildProperties, updatePageStats에 shares 추가 |
| src/ui/dashboard.html | 수정 | 4열→6열 그리드, 인용/공유 통계 카드 |
| src/ui/dashboard.js | 수정 | calculateEngagementRate에 quotes/shares 가중치, SYNC_NOW 호출 |
| src/ui/popup.js | 수정 | 결과 표시: "3개 새로고침, 1개 동기화" 형식 |

### **핵심 구현 로직:**

**1. popupSync() - 오늘의 핵심 기능 (커밋 #3)**
```javascript
// background.js - popupSync()
async function popupSync() {
  // STEP 1: 14일 이내 게시글 인사이트 새로고침
  const fourteenDaysAgo = new Date();
  fourteenDaysAgo.setDate(fourteenDaysAgo.getDate() - 14);

  const recentMappings = mappings.filter(m => {
    if (!m.postCreatedAt) return false;
    return new Date(m.postCreatedAt) >= fourteenDaysAgo;
  });

  for (const mapping of recentMappings) {
    const insights = await threadsApi.getThreadInsights(settings.threadsToken, mapping.threadId);
    await notionApi.updatePageStats(settings.notionSecret, mapping.notionPageId, insights, settings.fieldMapping);
    await storage.updateThreadInsights(mapping.threadId, insights);
    refreshedCount++;
  }

  // STEP 2: 마지막 게시글 이후 새 글 동기화
  let latestPostTime = null;
  for (const m of mappings) {
    if (m.postCreatedAt) {
      const postTime = new Date(m.postCreatedAt);
      if (!latestPostTime || postTime > latestPostTime) {
        latestPostTime = postTime;
      }
    }
  }

  return { success: true, refreshedCount, syncedCount };
}
```

**2. 참여율 계산 (가중치 적용) - 커밋 #2**
```javascript
// dashboard.js - calculateEngagementRate()
const engagementCount = (insights.likes || 0) +
                        (insights.replies || 0) * 2 +      // 댓글: 2배
                        (insights.reposts || 0) * 1.5 +    // 리포스트: 1.5배
                        (insights.quotes || 0) * 2 +       // 인용: 2배
                        (insights.shares || 0) * 1.5;      // 공유: 1.5배
```

### **적용된 기술/라이브러리:**
- Chrome Extension APIs (Storage, Alarms, Message Passing)
- Threads Graph API (게시글 조회, 인사이트 조회)
- Notion API (페이지 생성/업데이트)
- CSS Grid (6열 반응형 레이아웃)

---

## 4. 🐞 에러와 삽질의 기록 (Troubleshooting)

### **[에러 1] 노션-대시보드 데이터 불일치 (커밋 #2)**

* **Error Log:**
```
노션에는 shares가 저장되지만 대시보드에는 항상 0으로 표시됨
```

* **발생 상황:** shares 메트릭 추가 후 대시보드에서 공유 수가 항상 0으로 표시

* **Root Cause:**
  - **직접 원인:** `storage.js`의 두 함수에서 shares 필드 누락
    - `addThreadPageMapping()`: 새 게시글 저장 시 shares 미포함
    - `updateThreadInsights()`: 인사이트 업데이트 시 shares 미포함
  - **근본 원인:** 노션은 Threads API 데이터를 직접 저장하지만, 대시보드는 Chrome Storage 데이터를 사용 → **데이터 소스 이원화**로 인한 불일치

```
데이터 흐름 (문제):
[Threads API] → [Notion DB] ✅ shares 저장됨
[Threads API] → [Storage] → [Dashboard] ❌ shares 누락됨
```

* **Solution:**
```javascript
// Before (storage.js)
insights: insights || { views: 0, likes: 0, replies: 0, reposts: 0, quotes: 0 }

// After
insights: insights || { views: 0, likes: 0, replies: 0, reposts: 0, quotes: 0, shares: 0 }
```

* **Prevention:** 새 필드 추가 시 **데이터 흐름 체크리스트** 사용
  1. ☑️ API 응답에 필드 있는지 확인
  2. ☑️ Storage에 저장하는 **모든 함수** 확인
  3. ☑️ UI에서 읽어오는 모든 파일 확인
  4. ☑️ 백필(기존 데이터 업데이트) 필요 여부 확인

---

## 5. 💡 프롬프트 엔지니어링 코칭

### **😅 아쉬웠던 요청:**
> "노션에 저장된 데이터와 대시보드에 있는 데이터가 맞지 않는다고. 뭐가 문제인지 꼼꼼히 찾아봐"

### **✅ 이렇게 했으면 더 좋았다:**
> "shares 필드를 추가했는데, **노션에는 값이 저장되는데 대시보드에서만 0으로 표시돼**. 데이터 흐름(API → Storage → UI)을 전부 확인해서 누락된 부분 찾아줘."

### **🎓 배움 포인트:**
| 항목 | 문제점 | 개선 방법 |
|------|--------|----------|
| **누락된 정보** | "어디는 되고 어디는 안 된다"는 구체적 증상 없음 | 정상/비정상 케이스를 명확히 구분 |
| **모호했던 표현** | "데이터가 맞지 않다" | "노션엔 저장되는데 대시보드만 0이야"로 구체화 |
| **개선 핵심** | 문제 발생 시 **증상을 구체적으로** 설명하면 디버깅 시간 단축 |

---

### **[추가 코칭] 오늘 가장 좋았던 프롬프트 (모범 사례):**

> "옵션의 동기화 로직은 그대로 유지하고, 팝업의 동기화 버튼을 클릭하면 **작성일 기준 14일 이전까지의 게시글 인사이트 새로고침** + **가장 마지막 게시글의 작성시간 이후로 새로운 글이 있는지 체크 후 동기화** 하게끔 수정해줘"

**왜 좋았나:**
1. **범위 명시:** "옵션은 유지, 팝업만 수정"
2. **기준 명시:** "작성일 기준 14일"
3. **동작 명시:** "인사이트 새로고침 + 새 글 동기화"
4. **조건 명시:** "마지막 게시글 작성시간 이후"

→ **"무엇을 + 어떤 기준으로 + 언제"** 패턴을 기억하자!

---

## 6. 📦 콘텐츠 언번들링 (Unbundling Strategy)

### **(1) 🧵 스레드(Threads)용 마이크로 주제**

**주제 A: API 데이터 흐름 추적하는 법**
* **첫 줄 후킹:** "분명 저장은 되는데 화면에 안 나온다? 🤔"
* **시청자 베네핏:** 바이브코딩 중 데이터 불일치 버그를 빠르게 찾는 체크리스트

**주제 B: 좋은 프롬프트의 공식**
* **첫 줄 후킹:** "AI한테 '알아서 해줘' 하면 안 되는 이유"
* **시청자 베네핏:** "무엇을 + 어떤 기준으로 + 언제" 패턴으로 한 번에 원하는 결과 얻기

**주제 C: 참여율 가중치 설계**
* **첫 줄 후킹:** "좋아요 1개 vs 댓글 1개, 뭐가 더 가치 있을까?"
* **시청자 베네핏:** 콘텐츠 성과 측정에 가중치 개념 적용하는 법

### **(2) 🎬 유튜브 롱폼 아이디어 주제**

**주제 A: "나만의 스레드 대시보드 만들기"**
* **제목:** "코딩 1도 모르고 AI로 스레드 분석 대시보드 만든 방법"
* **시청자 베네핏:** Threads API + Notion API 연동으로 나만의 콘텐츠 분석 도구 구축

**주제 B: "바이브코딩 디버깅 A to Z"**
* **제목:** "'분명 되는데 안 돼요' 해결하는 5가지 체크포인트"
* **시청자 베네핏:** 데이터 흐름 추적으로 버그 빠르게 찾는 실전 노하우

### **(3) 🧩 콘텐츠 소스 매트릭스**

| 카테고리 | 구체적 주제 | 추천 포맷 | 난이도 |
|---------|-----------|----------|-------|
| 에러 해결 | 노션-대시보드 데이터 불일치 디버깅 | 카드뉴스/숏폼 | ⭐⭐ |
| 프롬프트 팁 | "무엇을+기준+언제" 공식 | 스레드 | ⭐ |
| 인사이트 | 참여율 가중치 설계 철학 | 에세이 | ⭐⭐⭐ |
| 기술 튜토리얼 | Chrome Extension 메시지 패싱 | 유튜브 롱폼 | ⭐⭐⭐ |
| 바이브코딩 철학 | "AI한테 알아서 해달라고 하면 안 되는 이유" | 스레드/릴스 | ⭐ |
| Before/After | 모호한 프롬프트 vs 명확한 프롬프트 비교 | 카드뉴스 | ⭐ |

---

## 7. 🚀 오늘의 회고 (KPT)

### **Keep** (잘한 점)
- **마지막 요청이 완벽했다:** "무엇을 + 어떤 기준으로 + 언제" 패턴 사용
- **로직 통일:** 팝업/대시보드 새로고침 버튼을 동일한 `popupSync()` 함수로 통일
- **가중치 참여율:** 단순 합산이 아닌 행동 유형별 가중치(댓글 2배, 공유 1.5배 등) 적용

### **Problem** (아쉬운 점)
- **데이터 흐름 미파악:** shares 필드 추가 시 Storage까지 체크 못해 시간 소요
- **용어 혼동:** "공유수"가 reposts인지 shares인지 처음에 불명확
- **디버깅 시간:** "데이터가 안 맞아"라고만 해서 원인 찾는 데 불필요한 시간 소요

### **Try** (내일 시도할 것)
- [ ] 새 필드 추가 시 **데이터 흐름 체크리스트** 사용하기
- [ ] 에러 발생 시 **"어디는 되고 어디는 안 된다"** 형식으로 구체적 증상 설명하기
- [ ] API 필드명을 프롬프트에 직접 언급하기 (한국어 용어 대신)

---

## 8. 📋 내일을 위한 메모

### **미완성 기능:**
- 브라우저 꺼진 상태에서 아침 9시 알람 놓쳤을 때 자동 새로고침 (24시간 체크 로직)
- 첫 사용자 온보딩 UX 개선 (전체 동기화 안내)

### **이어서 작업할 컨텍스트:**
- `refreshAllPostsStats()`는 7일 제한으로 **이미 복원됨** ✅
- `popupSync()`와 대시보드 새로고침이 동일 로직으로 **통일됨** ✅
- Meta 앱 검수 통과 후 실제 사용자 테스트 필요

### **내일 첫 프롬프트 예시:**
> "브라우저가 꺼져있다가 켜졌을 때, 마지막 통계 새로고침이 24시간 이상 지났으면 자동으로 popupSync()를 실행하는 로직을 추가해줘. chrome.runtime.onStartup 이벤트를 사용하고, lastStatsRefreshTime을 Storage에 저장해서 비교해."

---

*✨ Generated by Claude Code | 바이브코딩 회고 파트너 | 2025-12-15 23:22*
