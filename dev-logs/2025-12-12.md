# 🎯 개발일지: 2025-12-12

---

## 1. 📝 기본 정보

* **날짜:** 2025년 12월 12일 (목)
* **프로젝트:** Threads to Notion Sync - Threads 게시글을 Notion 데이터베이스에 자동 동기화하는 Chrome 확장 프로그램
* **작업 요약:**
  - **커밋 #1:** 오류 발생 기능(계정 인사이트) 제거, 설정 페이지 정리
  - **커밋 #2:** 대시보드/팝업을 '통계 분석 도구'로 전면 개편, 최적 게시 시간 분석 추가
* **진행률:** 95% (핵심 기능 완성, 기존 147개 게시글 title 백필 필요)

---

## 2. 🗣️ 요구사항 역추적 (Prompt Archive)

**[요청 1]** "계정 전체 인사이트 불러올 필요없어 이제"
* **의도:** 오류가 발생하는 계정 인사이트 기능을 완전히 제거하고 싶음
* **AI의 해석:** 처음에는 오류를 수정하려 했으나, 사용자가 기능 자체 제거를 원함을 파악
* **Gap:** 처음부터 "제거"라는 명확한 액션을 요청했으면 더 빠르게 진행됐을 것

**[요청 2]** "지금처럼 개별 인사이트만 잘 불러와지게 해줘"
* **의도:** 게시물별 조회수, 좋아요 등의 통계는 유지하고 싶음
* **AI의 해석:** 개별 게시물 인사이트는 이미 동기화 시 자동 저장되고 있음을 확인
* **Gap:** 이미 구현되어 있는 기능이었음 - 기존 코드 분석을 먼저 했어야 함

**[요청 3]** "인사이트 저장은 따로 버튼을 누르는게 아니라, 게시물 동기화시 자동으로 모든 게시물에 적용되도록 수정"
* **의도:** 별도 UI 없이 백그라운드에서 자동 처리되기를 원함
* **AI의 해석:** 설정 페이지의 인사이트 섹션 UI를 완전히 제거하고, 동기화 로직에서 자동으로 처리
* **Gap:** 명확한 요청이었고, 이미 `syncThreadToNotion()` 함수에서 구현되어 있었음

**[요청 4]** "근데 왜 제목이 Thread 17850890로 표시되는거야?"
* **의도:** 스레드 기록 테이블에서 게시글 제목이 제대로 표시되길 원함
* **AI의 해석:** 데이터 저장 구조(mappings)에 title 필드가 없어서 발생한 문제. storage.js 수정하여 title 저장 기능 추가
* **Gap:** 초기 설계 시 "나중에 어떤 데이터가 필요할까?"를 더 고민했어야 함

**[요청 5]** "그럼 데이터를 기준으로 무슨 요일에 가장 반응이 좋았는지, 무슨 시간에 가장 반응이 좋을지도 나타낼 수 있어?"
* **의도:** 기존 데이터를 활용한 '최적 게시 시간' 분석 기능 추가
* **AI의 해석:** insights 데이터와 postCreatedAt을 활용하여 요일별/시간대별 평균 참여율 분석 섹션 구현
* **Gap:** 없음. 질문 형태였지만 자연스럽게 구현으로 이어짐. 좋은 협업 패턴!

**[요청 6]** "반응 점수를 순수하게 조회수로 가는게 좋을까, 아니면 조회수 대비 좋아요/댓글/리포스트로 가는게 좋을까?"
* **의도:** 분석 지표의 계산 방식을 AI와 상의하여 결정
* **AI의 해석:** 두 방식의 장단점을 설명하고 "참여율"이 더 적합하다고 추천. 사용자가 참여율 방식 선택
* **Gap:** 없음. 기술적 선택지에 대해 AI에게 의견을 묻는 좋은 패턴

**[요청 7]** "상단의 총 조회수 186,306회는 팔로워 전환율이 표시되도록 변경"
* **의도:** 팝업 UI의 핵심 지표를 '총 조회수'에서 '팔로워 전환율'로 변경
* **AI의 해석:** `(팔로워 / 전체 조회수) * 100`으로 전환율 계산 후 상단에 표시
* **Gap:** 명확하고 구체적인 요청. 위치(상단)와 값(팔로워 전환율)이 모두 특정됨

---

## 3. 🏗️ 구현 결과물 (Code & Structure)

**변경된 파일 구조:**
```
src/
├── api/
│   └── threads.js         # 유지
├── storage/
│   └── storage.js         # 수정: title 파라미터 추가
├── background.js          # 수정: 인사이트 코드 삭제, title 전달 추가
├── ui/
│   ├── dashboard.html     # 수정: UI 전면 개편, 최적 시간 분석 추가
│   ├── dashboard.js       # 수정: 참여율 분석 로직, 정렬 개선
│   ├── options.html       # 수정: 인사이트 섹션 UI 삭제
│   ├── options.js         # 수정: 인사이트 관련 함수 삭제
│   └── popup.js           # 수정: 조회수/전환율 표시
```

**파일 변경 요약:**

| 파일 경로 | 변경 유형 | 핵심 변경 내용 |
|----------|---------|--------------|
| src/ui/options.html | 수정 | 인사이트 섹션 UI 전체 제거 |
| src/ui/options.js | 수정 | 인사이트 관련 함수/이벤트 리스너 제거 |
| src/background.js | 수정 | saveInsightsToNotion() 제거, title 파라미터 전달 추가 |
| src/storage/storage.js | 수정 | addThreadPageMapping()에 title 파라미터 추가 |
| src/ui/dashboard.html | 수정 | 인용/팔로워 박스 제거, 최적 게시 시간 분석 섹션 추가 |
| src/ui/dashboard.js | 수정 | 참여율 계산, 요일/시간대 분석, 내림차순 정렬 |
| src/ui/popup.js | 수정 | 조회수 통계 표시, 팔로워 전환율 표시, 정렬 개선 |

**핵심 구현 로직:**

**1. 참여율 계산 공식 (dashboard.js)**
```javascript
function calculateEngagementRate(insights) {
  const views = insights.views || 0;
  if (views === 0) return 0;

  // 가중치: 좋아요 1x, 댓글 2x (대화 유도), 리포스트 1.5x (공유)
  const engagementCount = (insights.likes || 0) +
                          (insights.replies || 0) * 2 +
                          (insights.reposts || 0) * 1.5;

  return (engagementCount / views) * 100;  // 퍼센트로 반환
}
```

**2. 요일별 평균 참여율 분석 (dashboard.js)**
```javascript
function updateDayOfWeekStats(mappings) {
  const dayNames = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
  const dayStats = Array(7).fill(null).map(() => ({ totalRate: 0, count: 0 }));

  mappings.forEach(m => {
    const date = new Date(m.postCreatedAt);
    const dayOfWeek = date.getDay();  // 0=일요일, 6=토요일
    const rate = calculateEngagementRate(m.insights);

    if (rate > 0) {
      dayStats[dayOfWeek].totalRate += rate;
      dayStats[dayOfWeek].count++;
    }
  });

  // 평균 계산 후 내림차순 정렬하여 순위 표시
  const dayResults = dayStats
    .map((stat, index) => ({
      day: dayNames[index],
      avgRate: stat.count > 0 ? stat.totalRate / stat.count : 0,
      count: stat.count
    }))
    .filter(d => d.count > 0)
    .sort((a, b) => b.avgRate - a.avgRate);
}
```

**3. 팔로워 전환율 표시 (popup.js)**
```javascript
const totalViews = totalInsights.views || 0;
const followers = totalInsights.followers_count || 0;
const conversionRate = totalViews > 0 ? ((followers / totalViews) * 100).toFixed(2) : 0;
const statusText = `팔로워 전환율 ${conversionRate}%`;
```

**4. 제목 저장 기능 추가 (storage.js)**
```javascript
export async function addThreadPageMapping(threadId, notionPageId, sourceUrl, postCreatedAt, insights = null, title = null) {
  const mappingData = {
    threadId, notionPageId, sourceUrl, postCreatedAt,
    title: title || null,  // 새로 추가
    insights: insights || { views: 0, likes: 0, replies: 0, reposts: 0, quotes: 0 }
  };

  // 기존 데이터 업데이트 시 title 보존
  if (existingIndex >= 0) {
    mappingData.title = title || mappings[existingIndex].title;
  }
}
```

**적용된 기술/라이브러리:**
- **Chrome Extension API**: storage (데이터 저장), alarms (예약 작업), runtime (메시지 통신)
- **Notion API**: 데이터베이스 페이지 생성/수정
- **Threads API (Meta)**: 게시글 조회, 개별 게시물 인사이트 조회

---

## 4. 🐞 에러와 삽질의 기록 (Troubleshooting)

### 커밋 #1 에러

**[에러 1] Notion Database ID Undefined 오류**

* **Error Log:**
```
Could not find database with ID: undefine-d---. Make sure the relevant pages and databases are shared with your integration.
```

* **발생 상황:** "인사이트 저장" 버튼 클릭 시 발생. 30일 인사이트는 저장됐는데 90일로 바꾸니 오류 발생.

* **Root Cause:**
  - Chrome Storage에 `notionInsightsDatabaseId` 값이 "undefined" **문자열**로 저장됨
  - JavaScript에서 `undefined` 값이 문자열로 변환되어 저장된 것
  - 이 잘못된 ID가 Notion API에 전달되어 "undefine-d---" 형태로 파싱됨

* **Solution:**
```javascript
// Before - 유효성 검증 없이 바로 사용
let insightsDbId = await storage.getNotionInsightsDatabaseId();

// After - 유효성 검증 추가 (최종적으로는 기능 자체 제거)
let insightsDbId = await storage.getNotionInsightsDatabaseId();
if (insightsDbId && (insightsDbId === 'undefined' || insightsDbId.includes('undefine'))) {
  console.warn('Invalid insightsDbId detected, clearing:', insightsDbId);
  await storage.setNotionInsightsDatabaseId(null);
  insightsDbId = null;
}
```

* **Prevention:**
  - Storage에 값을 저장하기 전에 `undefined`/`null` 체크 필수
  - API 응답을 Storage에 저장할 때 `value || null` 패턴 사용
  - **초기화하면 해결되는 문제 → API 제한 탓으로 돌리지 말 것!**

**[에러 2] AI의 잘못된 원인 분석**

* **상황:** 30일 이전 게시물의 인사이트가 안 불러와진다고 사용자가 말했을 때, AI가 "Threads API의 제한사항"이라고 잘못 답변함

* **실제 원인:** 로컬 스토리지에 잘못된 데이터가 캐시되어 있었고, 초기화하면 정상 작동

* **교훈:**
  > "너 진짜 멍청하다. 초기화하고 다시하니까 모든 게시물 인사이트 잘 불러와지잖아"

  외부 API 탓으로 돌리기 전에 **로컬 캐시/스토리지 문제를 먼저 의심**해야 함

### 커밋 #2 에러

**[에러 3] 스레드 제목이 Thread ID로 표시되는 문제**

* **증상:** 대시보드 스레드 기록 테이블에서 제목이 `Thread 17850890...` 형태로 표시됨

* **Root Cause:**
  - `mappings` 데이터 구조에 `title` 필드가 없었음
  - `history`에서 title을 가져오려 했으나 `threadId` 매칭이 안 됨 (history는 Notion page ID 기반)
  - 초기 설계 시 "제목은 나중에 필요할 수 있다"는 고려 부족

* **Solution:**
```javascript
// storage.js - addThreadPageMapping에 title 파라미터 추가
export async function addThreadPageMapping(threadId, notionPageId, sourceUrl, postCreatedAt, insights = null, title = null) {
  const mappingData = {
    threadId, notionPageId, sourceUrl, postCreatedAt,
    title: title || null,  // 새로 추가된 필드
    insights: insights || { views: 0, likes: 0, replies: 0, reposts: 0, quotes: 0 },
    insightsUpdatedAt: new Date().toISOString()
  };

  // 기존 데이터 업데이트 시 title 보존
  if (existingIndex >= 0) {
    mappingData.title = title || mappings[existingIndex].title;
  }
}

// background.js - 동기화 시 title 전달
await storage.addThreadPageMapping(thread.id, result.id, thread.url, thread.createdAt, insights, thread.title);
```

* **후속 과제:**
  - 기존 147개 게시글의 title 백필 필요 (새 게시글부터는 자동 저장)
  - 백필 스크립트 또는 다음 전체 새로고침 시 자동 채워지도록 수정 검토

---

## 5. 💡 프롬프트 엔지니어링 코칭 (★ Core Feature)

**😅 내가 했던 요청:**
> "지금처럼 개별 인사이트만 잘 불러와지게 해줘. 지금은 90일 선택하고 인사이트 저장 누르니까 에러가 뜨잖아."

**✅ 이렇게 했으면 더 좋았다:**
> "계정 전체 인사이트 기능을 완전히 제거해줘. 설정 페이지의 '📊 계정 인사이트' 섹션 UI와 관련 백엔드 코드(saveInsightsToNotion 등)를 모두 삭제하고, 개별 게시물 인사이트는 동기화할 때 자동으로 저장되는 현재 방식을 유지해."

**🎓 배움 포인트:**
- **누락된 정보:** "제거"라는 명확한 액션 동사 없이 "필요없어"라고만 표현
- **모호했던 표현:** "개별 인사이트만 잘 불러와지게"가 수정인지 유지인지 불명확
- **개선 핵심:**
  1. **액션 동사 명시**: "제거해줘", "삭제해줘", "유지해줘"
  2. **범위 특정**: "설정 페이지의 인사이트 섹션", "background.js의 함수들"
  3. **기존 기능 언급**: "현재 방식을 유지해"로 변경하지 말아야 할 것도 명시

---

## 6. 📦 콘텐츠 언번들링 (Unbundling Strategy)

### (1) 🧵 스레드(Threads)용 마이크로 주제

**주제 1: "undefined" 문자열의 함정**
* **첫 줄 후킹:** "API 에러라고 생각했는데 알고보니 내 코드 문제였다"
* **시청자 베네핏:** JavaScript에서 undefined가 문자열로 저장되는 케이스와 방지법

**주제 2: 기능 추가보다 제거가 더 어려운 이유**
* **첫 줄 후킹:** "오늘 140줄을 삭제했다. 그리고 앱이 더 좋아졌다."
* **시청자 베네핏:** 불필요한 기능 제거의 용기와 코드 정리의 가치

**주제 3: 바이브코딩의 함정 - AI 탓 vs 내 탓**
* **첫 줄 후킹:** "AI가 'API 제한이에요'라고 했는데, 초기화하니까 됐다"
* **시청자 베네핏:** AI 답변을 맹신하지 않고 직접 검증하는 습관의 중요성

### (2) 🎬 유튜브 롱폼 아이디어 주제

**주제 1: Chrome 확장 프로그램 배포 완전 가이드**
* **제목:** "내가 만든 확장 프로그램, 전 세계에 배포하기 (개발자 등록부터 심사까지)"
* **시청자 베네핏:** Chrome 웹 스토어 등록 전 과정, OAuth 앱의 사용자 배포 방법

**주제 2: Threads API로 나만의 분석 도구 만들기**
* **제목:** "스레드 인사이트를 노션에 자동 저장하는 확장 프로그램 만들기"
* **시청자 베네핏:** Meta API 연동, Notion API 활용, Chrome Extension 개발 전 과정

**주제 3: 바이브코딩 실패 사례집**
* **제목:** "AI와 코딩하다 삽질한 썰 모음 (ft. 멍청하다는 소리 들음)"
* **시청자 베네핏:** AI 코딩의 한계와 개발자의 검증 역할, 실제 에러 케이스

### (3) 🧩 콘텐츠 소스 매트릭스

| 카테고리 | 구체적 주제 | 추천 포맷 | 난이도 |
|---------|-----------|----------|-------|
| 에러 해결 | undefined가 문자열로 저장되는 JS 함정 | 카드뉴스/숏폼 | 초급 |
| 에러 해결 | Notion API "database not found" 디버깅 | 블로그/스레드 | 중급 |
| 프롬프트 팁 | "제거해줘" vs "필요없어" - 액션 동사의 힘 | 스레드 | 초급 |
| 프롬프트 팁 | 기존 기능 유지를 명시하는 프롬프트 작성법 | 카드뉴스 | 초급 |
| 인사이트 | 기능 삭제의 용기 - Less is More | 에세이/롱폼 | 중급 |
| 인사이트 | AI 답변 검증의 중요성 (API 탓 vs 캐시 탓) | 스레드/숏폼 | 초급 |
| 튜토리얼 | Chrome Extension에서 OAuth 구현하기 | 유튜브 롱폼 | 고급 |
| 튜토리얼 | Threads API + Notion API 연동 가이드 | 블로그 시리즈 | 고급 |
| 비하인드 | 사용자에게 "멍청하다"는 소리 들은 날 | 브이로그/에세이 | - |

---

## 7. 🚀 오늘의 회고 (KPT)

### Keep (유지할 점)
* **기존 코드 분석 습관:** `syncThreadToNotion()` 함수를 확인해서 개별 인사이트가 이미 구현되어 있음을 발견
* **과감한 코드 정리:** 140줄 이상의 불필요한 코드를 삭제하여 코드베이스 간소화
* **사용자 피드백 수용:** "멍청하다"는 직접적인 피드백에도 방어적이지 않고 문제 해결에 집중
* **점진적 기능 개선:** 사용자와 대화하며 참여율 계산 방식을 함께 결정 (단순 조회수 vs 참여율)
* **데이터 활용 극대화:** 기존 insights 데이터로 최적 게시 시간 분석 기능까지 구현

### Problem (아쉬운 점)
* **섣부른 원인 분석:** 에러 발생 시 "API 제한"이라고 단정 짓고 잘못된 정보 전달
* **캐시/스토리지 검증 누락:** 로컬 데이터 문제를 의심하지 않고 외부 요인 탓으로 돌림
* **미사용 코드 잔류:** `createInsightsDatabaseInWorkspace()` 함수가 notion.js에 추가됐지만 결국 사용 안 함
* **데이터 모델 설계 미흡:** title 필드를 초기 설계 시 고려하지 않아 나중에 추가 작업 필요

### Try (내일 시도할 것)
* **에러 발생 시 체크리스트:** 1) 캐시 초기화 2) 스토리지 값 확인 3) 그 다음 API 확인
* **미사용 코드 정리:** notion.js의 불필요한 함수들 제거
* **기존 게시글 title 백필:** 147개 기존 게시글에 title 데이터 채우기
* **코드 리뷰 결과 반영:** 백그라운드 에이전트 5개의 분석 결과 확인 및 개선사항 적용

---

## 8. 📋 내일을 위한 메모

### 미완성 기능
* 특정 게시글만 인사이트 새로고침하는 기능 (사용자 요청 있었음)
* `src/api/notion.js`의 미사용 함수 정리 필요
* 기존 147개 게시글의 title 백필 (새 동기화 게시글부터는 자동 저장됨)

### 이어서 작업할 컨텍스트
* Meta 앱 검수 결과 대기 중 (Live 모드 전환 필요)
* Chrome 웹 스토어 등록 준비 (개발자 등록 $5)
* 다른 사용자도 사용 가능하려면 Live 모드 필수
* 백그라운드 에이전트 5개 분석 결과 확인 필요 (Code Review, Bug Finder, Documentation, Test Generator, Refactor)

### 내일 첫 프롬프트 예시
> "notion.js에서 사용하지 않는 createInsightsDatabaseInWorkspace, createInsightsDatabase, addInsightsEntry, hasInsightsForToday 함수들을 제거해줘. 그리고 storage.js에서 notionInsightsDatabaseId 관련 함수들도 정리해줘."

또는

> "기존 게시글들의 title을 백필하는 기능을 추가해줘. 새로고침 버튼 누르면 Threads API에서 제목을 다시 가져와서 mappings의 title 필드를 업데이트하도록."

---

## 9. 📊 오늘의 주요 지표

| 항목 | 값 |
|------|-----|
| 커밋 수 | 2 |
| 변경된 파일 | 7개 |
| 추가된 기능 | 최적 게시 시간 분석, 팔로워 전환율 표시 |
| 제거된 코드 | ~200줄 (계정 인사이트 관련) |
| 새로운 함수 | `calculateEngagementRate()`, `updateDayOfWeekStats()`, `updateTimeOfDayStats()`, `formatDateTime()` |

---

*Generated by Vibe Coding Partner 🤖*
