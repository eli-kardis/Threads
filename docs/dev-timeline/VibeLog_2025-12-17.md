# ğŸ“… Vibe Log Timeline: 2025-12-17

> **Note:** `/commit` ëª…ë ¹ìœ¼ë¡œ ìë™ ê¸°ë¡ë˜ëŠ” Raw Data íŒŒì¼ì…ë‹ˆë‹¤.
> í•˜ë£¨ê°€ ëë‚˜ë©´ `/devlog` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì¢… ê°œë°œì¼ì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”.

**í”„ë¡œì íŠ¸:** Threads â†’ Notion Sync Chrome Extension
**ìƒì„± ì‹œê°„:** 2025-12-17 ì˜¤í›„

---

## â° [ì˜¤í›„] ì»¤ë°‹ #1

### 1. ğŸ—£ï¸ User Request (Raw Data)
**ì›ë³¸ í”„ë¡¬í”„íŠ¸:**
> ì§€ê¸ˆ ë³´ë‚´ì£¼ëŠ” ë‚´ìš©ì„ ê¼¼ê¼¼í•˜ê²Œ ì½ê³  api ë¦¬ë¯¸íŠ¸ê°€ ëª‡ì¸ì§€ ì•Œë ¤ì¤˜ë´ [Threads API ë¬¸ì„œ ì „ë¬¸]
>
> ì§€ê¸ˆ ìš°ë¦¬ê°€ ë§Œë“¤ì–´ë†“ì€ ë¡œì§ì„ ë°”íƒ•ìœ¼ë¡œ, ìœ ì € 1ëª…ë‹¹ í•˜ë£¨ ë¦¬ë¯¸íŠ¸ì— ê±¸ë¦¬ì§„ ì•ŠëŠ”ì§€ ì ê²€í•´ë´
>
> /Users/gwon-oseo/Threads/ISSUES_TO_FIX.md íŒŒì¼ì„ ì½ê³  ì¶”ê°€ë¡œ í™•ì¸í•´ì•¼í•˜ëŠ” ì‚¬í•­ì„ ì²´í¬í•´ë´
>
> ë°°í¬ ì „ ì–´ëŠ ë²”ìœ„ê¹Œì§€ ìˆ˜ì •í• ê¹Œìš”? â†’ "ì „ì²´ ìˆ˜ì •" ì„ íƒ

**AIê°€ íŒŒì•…í•œ ì˜ë„:**
- Chrome ì›¹ìŠ¤í† ì–´ ë°°í¬ ì „ ìµœì¢… ë³´ì•ˆ/í’ˆì§ˆ ì ê²€
- Threads API Rate Limit ì¤€ìˆ˜ ì—¬ë¶€ í™•ì¸
- ISSUES_TO_FIX.mdì— ê¸°ë¡ëœ 7ê°œ ë¯¸ìˆ˜ì • ì´ìŠˆ ì „ì²´ í•´ê²°

**ìš”ì²­ì—ì„œ ëˆ„ë½/ëª¨í˜¸í–ˆë˜ ì •ë³´:**
- ì—†ìŒ - ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¬¸ì„œ(ISSUES_TO_FIX.md)ê°€ ëª…í™•í•˜ê²Œ ì œê³µë¨
- ìˆ˜ì • ë²”ìœ„ë„ "ì „ì²´ ìˆ˜ì •"ìœ¼ë¡œ ëª…í™•íˆ ì„ íƒí•¨

### 2. ğŸ—ï¸ Implementation
**ë³€ê²½ëœ íŒŒì¼:**
| íŒŒì¼ ê²½ë¡œ | ì‘ì—… | ë‚´ìš© |
| :--- | :--- | :--- |
| src/ui/options.js | ìˆ˜ì • | XSS ì·¨ì•½ì  ìˆ˜ì • (innerHTML â†’ DOM API), Storage í‚¤ ìˆ˜ì •, ì—ëŸ¬ ë©”ì‹œì§€ ì •ë¦¬, ì½˜ì†” ë¡œê·¸ ì •ë¦¬ |
| src/background.js | ìˆ˜ì • | Race Condition í•´ê²° (Promise ê¸°ë°˜ ë½), ì½˜ì†” ë¡œê·¸ ì •ë¦¬ |
| src/api/notion.js | ìˆ˜ì • | Rate Limit íƒ€ì„ì•„ì›ƒ ì„¤ì • |
| ISSUES_TO_FIX.md | ìˆ˜ì • | ìˆ˜ì • ì™„ë£Œ í•­ëª© 7ê°œ ì²´í¬ |

**í•µì‹¬ ì½”ë“œ (Core Logic):**

1. **XSS-safe DOM í—¬í¼ í•¨ìˆ˜** (options.js)
```javascript
function createConnectedUI(service, subText) {
  const container = document.createElement('div');
  container.style.cssText = 'background: #D1FAE5; padding: 16px; border-radius: 10px; text-align: center;';

  const sub = document.createElement('p');
  sub.textContent = service === 'threads' ? `User ID: ${subText || 'N/A'}` : (subText || 'Workspace');

  container.appendChild(sub);
  return container;
}
```

2. **Promise ê¸°ë°˜ ë½ íŒ¨í„´** (background.js)
```javascript
let syncPromise = null;
const isSyncing = () => syncPromise !== null;

async function popupSync() {
  if (syncPromise) {
    return syncPromise;  // ê¸°ì¡´ ì‘ì—… ê²°ê³¼ ë°˜í™˜
  }

  syncPromise = doPopupSync();
  try {
    return await syncPromise;
  } finally {
    syncPromise = null;
  }
}
```

3. **Rate Limit íƒ€ì„ì•„ì›ƒ** (notion.js)
```javascript
const MAX_WAIT_TIME = 5000; // ìµœëŒ€ ëŒ€ê¸° ì‹œê°„ 5ì´ˆ

async function waitForRateLimit() {
  if (timeSinceLastRequest < REQUEST_DELAY) {
    const waitTime = Math.min(REQUEST_DELAY - timeSinceLastRequest, MAX_WAIT_TIME);
    await new Promise(resolve => setTimeout(resolve, waitTime));
  }
}
```

4. **ì¡°ê±´ë¶€ ë¡œê¹…** (options.js, background.js)
```javascript
const DEBUG = false;
const log = DEBUG ? console.log.bind(console) : () => {};
```

**ì ìš© ê¸°ìˆ /ë¼ì´ë¸ŒëŸ¬ë¦¬:**
- DOM API (createElement, replaceChildren, textContent)
- Promise ê¸°ë°˜ ë™ì‹œì„± ì œì–´
- ì¡°ê±´ë¶€ ë¡œê¹… íŒ¨í„´

### 3. ğŸ Trouble & Fix
**ì—ëŸ¬ ë°œìƒ ì—¬ë¶€:** âœ… ìˆìŒ (ì´ì „ ì„¸ì…˜)

**Error Log:**
```
Failed to refresh insights for 17850890283568084: ReferenceError: delay is not defined
```

**ì›ì¸ ë¶„ì„:**
- `background.js`ì—ì„œ `delay()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆì§€ë§Œ importí•˜ì§€ ì•ŠìŒ
- `utils.js`ì—ëŠ” ë™ì¼ ê¸°ëŠ¥ì˜ `sleep()` í•¨ìˆ˜ê°€ ì¡´ì¬

**í•´ê²° ê³¼ì •:**
```javascript
// Before
import { generateId, formatDate } from './shared/utils.js';
await delay(350);

// After
import { generateId, formatDate, sleep } from './shared/utils.js';
await sleep(350);
```

### 4. ğŸ’¡ Prompt Reflection (Micro-Coaching)
**ğŸ˜… ì´ ë¶€ë¶„ì´ ì•„ì‰¬ì› ë‹¤:**
- ì—†ìŒ - ISSUES_TO_FIX.md ë¬¸ì„œê°€ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬ë˜ì–´ ìˆì–´ ëª…í™•í–ˆìŒ

**âœ… ì´ë ‡ê²Œ ìš”ì²­í–ˆìœ¼ë©´ ì™„ë²½í–ˆë‹¤ (Best Practice):**
> "ë°°í¬ ì „ ISSUES_TO_FIX.mdì˜ ë¯¸ìˆ˜ì • ì´ìŠˆ 7ê°œë¥¼ ì „ë¶€ ìˆ˜ì •í•´ì¤˜. Critical/High ìš°ì„ ìœ¼ë¡œ ì§„í–‰í•˜ê³ , ìˆ˜ì • í›„ ë¬¸ì„œë„ ì—…ë°ì´íŠ¸í•´ì¤˜."

**ğŸ“ ë°°ìš´ ì :**
- ë³´ì•ˆ ì´ìŠˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¯¸ë¦¬ ë¬¸ì„œí™”í•´ë‘ë©´ ë°°í¬ ì „ ì ê²€ì´ ì²´ê³„ì ìœ¼ë¡œ ì§„í–‰ë¨
- innerHTML XSS ì·¨ì•½ì ì€ DOM API í—¬í¼ í•¨ìˆ˜ë¡œ ê¹”ë”í•˜ê²Œ í•´ê²° ê°€ëŠ¥
- Race Conditionì€ í”Œë˜ê·¸ ê¸°ë°˜ë³´ë‹¤ Promise ê¸°ë°˜ ë½ì´ ë” ì•ˆì „í•¨
- í”„ë¡œë•ì…˜ ë°°í¬ ì „ console.log ì •ë¦¬ëŠ” ì¡°ê±´ë¶€ ë¡œê¹… íŒ¨í„´ìœ¼ë¡œ ê°„ë‹¨íˆ ì²˜ë¦¬

---

## â° [ì˜¤í›„] ì»¤ë°‹ #2

### 1. ğŸ—£ï¸ User Request (Raw Data)
**ì›ë³¸ í”„ë¡¬í”„íŠ¸:**
> /devlog
>
> ì§€ê¸ˆ ìƒíƒœí‘œì‹œì¤„ì— í‘œì‹œë˜ëŠ” ì§„í–‰ë¥  ë°”ì— ì˜¤ë¥˜ê°€ ìˆì–´. í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ì´ ì•„ë‹Œ ì„¸ì…˜ ëˆ„ì  í† í°ì„ ë°˜í™˜í•˜ì—¬ ì»¨í…ìŠ¤íŠ¸ ë°”ê°€ ë¶€ì •í™•í•´
>
> current_usage í•„ë“œê°€ ì¶”ê°€ëë‹¤ë©°? í•´ë‹¹ í•„ë“œì˜ input_tokensê°€ ì‹¤ì œ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ì„ ë°˜ì˜í•œëŒ€. ì°¸ê³ í•´ë´

**AIê°€ íŒŒì•…í•œ ì˜ë„:**
- ê°œë°œì¼ì§€ ìƒì„± ë° ë¬¸ì„œí™”
- Claude Code ìƒíƒœí‘œì‹œì¤„ì´ ì˜ëª»ëœ í† í° ìˆ˜ì¹˜ë¥¼ í‘œì‹œí•˜ëŠ” ë¬¸ì œ í•´ê²°
- `current_usage.input_tokens` í•„ë“œ ì‚¬ìš©ìœ¼ë¡œ ì •í™•í•œ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ í‘œì‹œ

**ìš”ì²­ì—ì„œ ëˆ„ë½/ëª¨í˜¸í–ˆë˜ ì •ë³´:**
- ì´ˆê¸°ì— ì •í™•í•œ JSON í•„ë“œ ê²½ë¡œê°€ ë¶ˆë¶„ëª…í–ˆìœ¼ë‚˜, ì‚¬ìš©ìê°€ `current_usage.input_tokens` í•„ë“œë¥¼ ëª…ì‹œí•´ì¤Œ

### 2. ğŸ—ï¸ Implementation
**ë³€ê²½ëœ íŒŒì¼:**
| íŒŒì¼ ê²½ë¡œ | ì‘ì—… | ë‚´ìš© |
| :--- | :--- | :--- |
| dev-logs/2025-12-17.md | ìƒì„± | ì „ì²´ ê°œë°œì¼ì§€ ìƒì„± (ë³´ì•ˆ/í’ˆì§ˆ ì´ìŠˆ í•´ê²° ê³¼ì • ë¬¸ì„œí™”) |
| ~/.claude/statusline.sh | ìˆ˜ì • | ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ í‘œì‹œ ìˆ˜ì • (í”„ë¡œì íŠ¸ ì™¸ë¶€ íŒŒì¼) |

**í•µì‹¬ ì½”ë“œ (Core Logic):**

1. **ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ ì •í™•íˆ ì½ê¸°** (statusline.sh)
```bash
# Before (ì„¸ì…˜ ëˆ„ì  í† í°)
CURRENT_TOKENS=$(echo "$input" | jq -r '.context_window.total_input_tokens // 0')

# After (ì‹¤ì œ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰)
CURRENT_TOKENS=$(echo "$input" | jq -r '.context_window.current_usage.input_tokens // 0')
```

**ì ìš© ê¸°ìˆ /ë¼ì´ë¸ŒëŸ¬ë¦¬:**
- jq (JSON íŒŒì‹±)
- Bash ìŠ¤í¬ë¦½íŠ¸
- Claude Code statusline API

### 3. ğŸ Trouble & Fix
**ì—ëŸ¬ ë°œìƒ ì—¬ë¶€:** âœ… ìˆìŒ

**Error Log:**
```
ìƒíƒœí‘œì‹œì¤„ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰ì´ 0%ë¡œ ì‹œì‘í•˜ì§€ ì•Šê³  ì´ì „ ì„¸ì…˜ì˜ ëˆ„ì ê°’ìœ¼ë¡œ í‘œì‹œë¨
```

**ì›ì¸ ë¶„ì„:**
- `total_input_tokens`ëŠ” ì„¸ì…˜ ì „ì²´ ëˆ„ì  í† í° ìˆ˜
- `current_usage.input_tokens`ê°€ ì‹¤ì œ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ì‚¬ìš©ëŸ‰

**í•´ê²° ê³¼ì •:**
- ì‚¬ìš©ìì˜ í”¼ë“œë°±ìœ¼ë¡œ ì˜¬ë°”ë¥¸ JSON í•„ë“œ ê²½ë¡œ í™•ì¸
- `statusline.sh`ì—ì„œ ì½ëŠ” í•„ë“œë¥¼ `current_usage.input_tokens`ë¡œ ë³€ê²½

### 4. ğŸ’¡ Prompt Reflection (Micro-Coaching)
**ğŸ˜… ì´ ë¶€ë¶„ì´ ì•„ì‰¬ì› ë‹¤:**
- ì—†ìŒ - ì‚¬ìš©ìê°€ ì •í™•í•œ í•„ë“œëª…ì„ ì œê³µí•´ì¤Œ

**âœ… ì´ë ‡ê²Œ ìš”ì²­í–ˆìœ¼ë©´ ì™„ë²½í–ˆë‹¤ (Best Practice):**
> "ìƒíƒœí‘œì‹œì¤„ì˜ ì»¨í…ìŠ¤íŠ¸ ë°”ê°€ ë¶€ì •í™•í•´. `context_window.current_usage.input_tokens` í•„ë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ statusline.shë¥¼ ìˆ˜ì •í•´ì¤˜."

**ğŸ“ ë°°ìš´ ì :**
- Claude Codeì˜ `context_window` ê°ì²´ì—ì„œ:
  - `total_input_tokens`: ì„¸ì…˜ ëˆ„ì  í† í°
  - `current_usage.input_tokens`: ì‹¤ì œ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰
- ìƒíƒœí‘œì‹œì¤„ ìŠ¤í¬ë¦½íŠ¸ëŠ” `~/.claude/statusline.sh`ì— ìœ„ì¹˜
