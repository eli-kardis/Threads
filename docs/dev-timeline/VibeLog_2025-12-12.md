# 📅 Vibe Log Timeline: 2025-12-12

> **Note:** `/commit` 명령으로 자동 기록되는 Raw Data 파일입니다.
> 하루가 끝나면 `/devlog` 명령어를 사용하여 최종 개발일지를 생성하세요.

**프로젝트:** Threads to Notion Sync (Chrome Extension)
**생성 시간:** 2025-12-12

---

## ⏰ [현재] 커밋 #1

### 1. 🗣️ User Request (Raw Data)
**원본 프롬프트:**
> 계정 전체 인사이트 불러올 필요없어 이제
> 지금처럼 개별 인사이트만 잘 불러와지게 해줘. 지금은 90일 선택하고 인사이트 저장 누르니까 에러가 뜨잖아.
> 인사이트 저장은 따로 버튼을 누르는게 아니라, 게시물 동기화시 자동으로 모든 게시물에 적용되도록 수정

**AI가 파악한 의도:**
- 계정 전체 인사이트 기능 제거 (오류 발생 원인)
- 개별 게시물 인사이트는 동기화 시 자동 저장되도록 유지
- UI에서 인사이트 섹션 완전 제거

**요청에서 누락/모호했던 정보:**
- 처음에는 계정 인사이트 기능을 수정하려 했으나, 사용자가 해당 기능 자체를 제거 요청

### 2. 🏗️ Implementation
**변경된 파일:**
| 파일 경로 | 작업 | 내용 |
| :--- | :--- | :--- |
| src/ui/options.html | 삭제 | 인사이트 섹션 UI 전체 제거 |
| src/ui/options.js | 삭제 | 인사이트 관련 elements, 이벤트 리스너, 함수 제거 |
| src/background.js | 삭제 | saveInsightsToNotion(), getDatabaseInfo(), getAccountInsightsData() 함수 및 핸들러 제거 |
| src/api/notion.js | 추가 | createInsightsDatabaseInWorkspace() 함수 추가 (이전 작업, 결국 미사용) |

**핵심 코드 (Core Logic):**
```javascript
// background.js - dailyStatsRefresh 알람에서 계정 인사이트 호출 제거
// 기존
} else if (alarm.name === 'dailyStatsRefresh') {
  await refreshAllPostsStats();
  await saveInsightsToNotion(7);
  await saveInsightsToNotion(30);
}

// 변경 후
} else if (alarm.name === 'dailyStatsRefresh') {
  await refreshAllPostsStats();
}
```

**적용 기술/라이브러리:**
- Chrome Extension API (storage, alarms, runtime)
- Notion API
- Threads API

### 3. 🐞 Trouble & Fix
**에러 발생 여부:** ✅ 있음

**Error Log:**
```
Could not find database with ID: undefine-d---. Make sure the relevant pages and databases are shared with your integration.
```

**원인 분석:**
- Chrome Storage에 잘못된 `notionInsightsDatabaseId` 값("undefined" 문자열)이 저장됨
- 이 값이 Notion API에 전달되어 오류 발생

**해결 과정:**
- 처음에는 유효성 검증 코드 추가 시도
- 최종적으로 사용자 요청에 따라 계정 인사이트 기능 전체 제거

### 4. 💡 Prompt Reflection (Micro-Coaching)
**😅 이 부분이 아쉬웠다:**
- API 제한으로 인한 문제라고 잘못 추측하여 사용자에게 잘못된 정보 전달

**✅ 이렇게 요청했으면 완벽했다 (Best Practice):**
> "계정 전체 인사이트 기능 제거해줘. 개별 게시물 인사이트는 동기화할 때 자동으로 저장되니까 그건 유지하고, 설정 페이지의 인사이트 섹션만 삭제해."

**🎓 배운 점:**
- 에러 발생 시 API 제한 탓으로 돌리기 전에 로컬 스토리지/캐시 문제를 먼저 확인해야 함
- 기존 기능이 이미 요구사항을 충족하는지 먼저 확인 (개별 인사이트는 이미 자동 저장 중이었음)

---

## ⏰ [15:45] 커밋 #2

### 1. 🗣️ User Request (Raw Data)
**원본 프롬프트:**
> 일별 조회수 차트 위에 있는 인용/팔로워 박스는 제거.
> 스레드 기록은 작성시간 내림차순으로 정렬되게 변경
> 근데 왜 제목이 Thread 17850890로 표시되는거야?
> 그럼 데이터를 기준으로 무슨 요일에 가장 반응이 좋았는지, 무슨 시간에 가장 반응이 좋을지도 나타낼 수 있어?
> 반응 점수를 순수하게 조회수로 가는게 좋을까, 아니면 조회수 대비 좋아요/댓글/리포스트 로 가는게 좋을까?
> 이제 이것도 변경해야지. 자동 동기화 활성은 조회수로 변경, 오늘/이번주/이번달의 숫자는 이번주/이번달/전체로 변경하고 각 기간별 조회수 숫자가 표시되게 수정
> 상단의 총 조회수 186,306회는 팔로워 전환율이 표시되도록 변경. 아래의 최근활동 목록도 내림차순으로 표시되게 변경

**AI가 파악한 의도:**
- 대시보드 UI 개선: 불필요한 요소 제거, 정렬 개선, 최적 게시 시간 분석 추가
- 팝업 UI 개선: 동기화 현황 → 조회수 통계로 변경, 팔로워 전환율 표시
- 참여율 기반 분석: 단순 조회수가 아닌 조회수 대비 참여율로 최적 시간 분석

**요청에서 누락/모호했던 정보:**
- 제목이 Thread ID로 표시되는 원인 (mappings에 title이 저장되지 않았음)
- 참여율 계산 방식에 대한 선호도 (사용자에게 질문 후 확정)

### 2. 🏗️ Implementation
**변경된 파일:**
| 파일 경로 | 작업 | 내용 |
| :--- | :--- | :--- |
| src/ui/dashboard.html | 수정 | 인용/팔로워 박스 제거, 최적 게시 시간 분석 섹션 추가, CSS 스타일 추가 |
| src/ui/dashboard.js | 수정 | 작성시간 내림차순 정렬, 참여율 기반 요일/시간대별 분석, 일별 조회수 차트 수정 |
| src/storage/storage.js | 수정 | addThreadPageMapping에 title 파라미터 추가 |
| src/background.js | 수정 | 매핑 저장 시 thread.title 전달 |
| src/ui/popup.js | 수정 | 조회수 통계 표시, 팔로워 전환율 표시, 최근 활동 내림차순 정렬 |

**핵심 코드 (Core Logic):**
```javascript
// 참여율 계산 (dashboard.js)
function calculateEngagementRate(insights) {
  const views = insights.views || 0;
  if (views === 0) return 0;
  const engagementCount = (insights.likes || 0) +
                          (insights.replies || 0) * 2 +
                          (insights.reposts || 0) * 1.5;
  return (engagementCount / views) * 100;
}

// 요일별 평균 참여율 분석
function updateDayOfWeekStats(mappings) {
  const dayNames = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
  // ... 각 요일별 참여율 계산 후 순위 정렬
}

// 팔로워 전환율 (popup.js)
const conversionRate = totalViews > 0 ? ((followers / totalViews) * 100).toFixed(2) : 0;
const statusText = `팔로워 전환율 ${conversionRate}%`;
```

**적용 기술/라이브러리:**
- Chrome Extension API (storage, runtime messaging)
- Chart.js (일별 조회수 차트)
- JavaScript Date API (요일/시간대 분석)

### 3. 🐞 Trouble & Fix
**에러 발생 여부:** ✅ 있음

**Error Log:**
```
Thread 17850890... (제목 대신 ID 표시)
```

**원인 분석:**
- mappings 저장 시 title이 포함되지 않았음
- history에서 title을 가져오려 했으나 threadId 매칭 실패

**해결 과정:**
```javascript
// storage.js - addThreadPageMapping에 title 파라미터 추가
export async function addThreadPageMapping(threadId, notionPageId, sourceUrl, postCreatedAt, insights = null, title = null) {
  const mappingData = {
    threadId, notionPageId, sourceUrl, postCreatedAt,
    title: title || null,  // 새로 추가
    insights: insights || { views: 0, likes: 0, replies: 0, reposts: 0, quotes: 0 },
    insightsUpdatedAt: new Date().toISOString()
  };
  // 기존 데이터 업데이트 시 title 보존
  if (existingIndex >= 0) {
    mappingData.title = title || mappings[existingIndex].title;
  }
}

// background.js - 동기화 시 title 전달
await storage.addThreadPageMapping(thread.id, result.id, thread.url, thread.createdAt, insights, thread.title);
```

### 4. 💡 Prompt Reflection (Micro-Coaching)
**😅 이 부분이 아쉬웠다:**
- 여러 요청을 순차적으로 하여 맥락이 분산됨

**✅ 이렇게 요청했으면 완벽했다 (Best Practice):**
> "대시보드 개선해줘:
> 1. 인용/팔로워 박스 제거
> 2. 스레드 기록을 작성시간 내림차순 정렬하고 제목이 제대로 표시되게
> 3. 요일별/시간대별 최적 게시 시간 분석 추가 (조회수 대비 참여율 기준)
> 4. 팝업도 조회수 통계와 팔로워 전환율 표시로 변경"

**🎓 배운 점:**
- 데이터 모델 설계 시 나중에 필요할 수 있는 필드(title)를 미리 고려해야 함
- 단순 수치(조회수)보다 비율(참여율)이 콘텐츠 품질 분석에 더 유의미함
- 기존 데이터 마이그레이션(백필) 필요성 고려
